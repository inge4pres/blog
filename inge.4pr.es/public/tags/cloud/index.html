<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    cloud - inge4pres
  </title><meta name="generator" content="Hugo 0.98.0" /><link
    rel="stylesheet"
    href="https://inge.4pr.es/css/styles.css"
    integrity=""
  />
  
  <script>
    
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  </script>
  
</head>

  <body
    class="flex flex-col min-h-screen dark:bg-gray-900 dark:text-gray-100 transition-colors duration-500"
  ><header class="w-full px-4 pt-4 max-w-5xl mx-auto">
  <nav class="flex items-center justify-between flex-wrap">
    <div class="flex gap-2 items-center">
      
      <a href="mailto:fgualazzi@gmail.com" aria-label="EMail">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="4" />
          <path d="M16 12v1.5a2.5 2.5 0 0 0 5 0v-1.5a9 9 0 1 0 -5.5 8.28" />
        </svg>
      </a>
      
      <a href="https://inge.4pr.es/" class="flex items-center font-bold">
        inge4pres
      </a>
    </div>

    <ul id="nav-menu" class="flex w-auto mt-0 space-x-2">
      
      <li>
        <a href="https://inge.4pr.es/about/" class="hover:text-blue-800 dark:hover:text-blue-300">You are what you is (F. Zappa)</a>
      </li>
      
      
      <li>
        <a href="https://inge.4pr.es/categories/blog/" class="hover:text-blue-800 dark:hover:text-blue-300">blog</a>
      </li>
      
    </ul>
  </nav>
</header>
<main class="flex-1 mx-4 md:mx-12 lg:mx-24 mt-8 sm:mt-16"> 
<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2016-09-18-a-benchmark-of-aws-efs/">A benchmark of AWS EFS</a></h1>
  <p>Amazon Web Services <!-- raw HTML omitted -->Elastic File System<!-- raw HTML omitted --> has been to my knowledge the service to have the longest beta testing period: reason for this may be that not as many client as expected tested it and AWS received too few feedback on it or that there were¬†issues not to release GA. I don‚Äôt want to speculate on which one is correct but now that¬†it¬†has been <!-- raw HTML omitted -->officially released<!-- raw HTML omitted --> I decided to give it a try and of course compare it to a self-managed¬†solution on the same platform.</p>
<p>If you followed¬†AWS evolution¬†you may agree that EFS has been introduced to fill the gap between EBS storage and S3: before EFS was live there was no ‚Äúeasy‚Äù way of having a distributed file system in AWS, you could only <!-- raw HTML omitted -->set up your own<!-- raw HTML omitted --> using ¬†a combination of EC2 instances mounting Elastic Block Storage volumes and S3. Now with EFS you can have a AWS-managed distributed file system to be used in your cloud environment or even across the internet (will try that on a public subnet) with all the benefits of offloading the high-availability and replication burden to Amazon, and at a reasonable¬†price. Will performance be enough compared to a self-managed solution?</p>
<h5 id="playground">Playground</h5>
<p>I use¬†<!-- raw HTML omitted -->terraform<!-- raw HTML omitted --> to create an infrastructure template to run the tests, you can see it <!-- raw HTML omitted -->here<!-- raw HTML omitted -->. Once</p>
<!-- raw HTML omitted -->
<p>has finished, you‚Äôll end up with:</p>
<ul>
<li>An EFS with General Purpose performance mode</li>
<li>An EFS mount target for 1 Availability Zone</li>
<li>1 EC2 instance named ‚Äúclient‚Äù to mount remote file systems</li>
<li>2 EC2 instances named ‚Äúserver_X‚Äù each one with a 10 GB General Purpose EBS, they will serve a self-managed distributed, replicated file system</li>
</ul>
<p>This is the terraform output and the steps to run on the 2 server nodes to have a running GlusterFS replicated volume; to configure the NFS export on server1, I used <!-- raw HTML omitted -->this guide<!-- raw HTML omitted -->.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>On the client I mount the EFS target with NFS4.1, the GlusterFS volume from the server <em>in the same subnet</em> via the GlusterFS native client_¬†_and the NFS export on the client‚Äôs designated mount points. I use the server on the same subnet as the client is, because the EFS target exposes a mount point in the same¬†subnet and latency is a key factor in remote file system.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h5 id="benchmark-tests">Benchmark Tests</h5>
<p>I used <!-- raw HTML omitted -->fio<!-- raw HTML omitted --> installed on the client box with a command suggested by this <!-- raw HTML omitted -->BinaryLane post<!-- raw HTML omitted -->¬†and run it against the mount point for EFS, GlusterFS and NFS v4.0 with the following command</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>changing the target directory each time I tun the test; each test is run isolated.</p>
<p>I did not customize any storage option for GlusterFS or NFS, so I‚Äôm using the default options.</p>
<h5 id="benchmarkresults">Benchmark¬†Results</h5>
<h6 id="efs">EFS</h6>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h6 id="glusterfs">GlusterFS</h6>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h6 id="nfs-40-not-replicated">NFS 4.0 (not replicated)</h6>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h6 id="pricing-considerations">Pricing considerations</h6>
<p>EFS pricing is linear, you get billed a fixed amount for GB/month; this is not true with a self-managed cluster where you can surely reach higher performance,¬†but the TCO is increasing every time you add capacity.¬†If you‚Äôre not satisfied with EFS throughput you need a dedicated team to ¬†manage a distributed file system cluster and its operations and maintenance.</p>
<h6 id="conclusions">Conclusions</h6>
<p>If you need a stable, realiable¬†file system in AWS to be shared between EC2 instances, go and¬†use EFS and don‚Äôt reinvent the wheel: GlusterFS is outperformed in both read and write IOPS and bandwith with the default options! The workload simulated here is showing poor write performance, so if your use case is a lot of concurrent writes on many files, consider another solution. A good workload could be a WORM (Write Once Read Many) share for permanent stored contents (images, archives?).</p>
<p>The performance are still low in absolute terms or compared to a non-replicated mount such as a stock NFS v4.0 server without the high-availability burden, but if you don‚Äôt care about 100% uptime you should definitely¬†set up NFS with <!-- raw HTML omitted -->DRDB<!-- raw HTML omitted --> to a secondary node, and switch your mounts when the primary node fails. But still: why manage all of this if AWS can do it for you?</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2016-04-06-aws-iam-policy-to-let-users-manage-their-own-mfa/">AWS IAM policy to let users manage their own MFA</a></h1>
  <p>If you‚Äôre an AWS administrator you know that managing web console security is pretty tough unless you know what you want and you know what you‚Äôre doing. So if what you want is let each AWS user manage their own MFA device configuration without you and force them to have MFA active to use the web console, here is your solution.</p>
<p><strong>TL;DR</strong></p>
<ul>
<li>Create one or more groups with your web users</li>
<li>Create a new policy using <!-- raw HTML omitted -->this JSON<!-- raw HTML omitted --></li>
<li>Attach the policy to the group(s)</li>
</ul>
<p><strong>How does it work?</strong></p>
<p>The policy has this logic:</p>
<ul>
<li>Allow basic¬†operations on IAM without having MFA set up</li>
<li>Allow setup and management of MFA for own user in IAM (create, delete, resync device)</li>
<li>Deny every action on every resource when MFA is not setup</li>
<li>Allow user to access IAM without MFA ‚Äì this is necessary to sub-segment the previous rule</li>
</ul>
<p>The magic lies in the use of ARN policy variables which is a poorly documented feature of IAM. Notice how in some case the statement makes use of <code>${aws:username}</code> to confine the action executed on the only user receiving¬†the policy grants.</p>
<p>This IAM policy blocks every serice usage when MFA is not setup, and in conjunction with default IAM behavior will deny access on every action if not explicitly given. You should combine this ‚Äúbase‚Äù policy with other group/service oriented policies to confine web users on certain functionalities. For example if you want a set of users self-managing their own MFA and access the EC2 service only after having setup MFA, you should execute the following after having setup the IAMUsersMFAManagement policy.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>``Reference: <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_variables.html">AWS IAM variables documentation</a></p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2015-08-02-golang-message-queue-a-simple-tcp-message-bus/">Golang Message Queue: a simple TCP message bus</a></h1>
  <p><strong>[TL;DR]</strong></p>
<p>I wrote a Pub/Sub message queue in <!-- raw HTML omitted -->Go<!-- raw HTML omitted -->, branch ‚Äúmaster‚Äù is stable but missing some interesting feature like distributed memory synchronization between nodes in a cluster and encryption. Code at</p>
<p><!-- raw HTML omitted --><a href="https://github.com/inge4pres/gmq">https://github.com/inge4pres/gmq</a><!-- raw HTML omitted --></p>
<p>Being a cloud system engineer, my work is to design and implement distributed systems: one of the key principles in designing such architectures is <em>decoupling</em>, which means ensuring the many parts composing the system are able to share informations and complete a sequence of operations without being tied together. You can read more about cloud architectures and decoupling here.</p>
<p>One of the most common scenario in a cloud application is a series of asynchronous operations executed by many nodes on different layers: for example a front end server tier receiving¬† files and a backend server tier doing analysis on them; a good practice is to have a message queue between the two serving as an orchestration component. Each web server node will post a message in the queue for every files received, each backend node will consume a message from the queue to complete his operations on the files. In this way the two tiers are independent one from each other: in case of backend failure or over-capacity, the web servers will keep receiving files and storing message in the queue. If the two operations where done synchronously, the backend failure would stop the whole system to work.</p>
<p>A lot of <em>off-the-shelf</em> message queue software is already available, but I felt like writing my own would give me a good point of view on system programming with Go, so I wrote it, and the result is pretty awesome too. In a few days I was able to have a configurable message queue storing messages in memory, on filesystem or database (MySQL); communication is based on JSON via TCP, and the server can be configured to support a maximum number of queues, a maximum message length and queue capacity: combination of the configured parameters will have performance effects on the single node.</p>
<p>The roadmap of ‚Äúdeveloment‚Äù branch is:</p>
<ul>
<li>adding cluster mode</li>
<li>adding memory synchronization in cluster mode</li>
<li>adding encryption: TLS over TCP</li>
<li>adding client authentication</li>
</ul>
<p>As you may have guessed from the above list, security of GMQ is not implemented at the moment, be careful!</p>
<p>Feel free to try it out and give suggestions!</p>
<p>Cheers üòÄ</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2015-03-11-glusterfs-is-it-suitable-for-me/">GlusterFS: is it suitable for me?</a></h1>
  <p>During the last years I‚Äôve been experimenting with <!-- raw HTML omitted -->GlusterFS<!-- raw HTML omitted --> and his functionalities as distributed object store; a lot has changed in the software, overall since <!-- raw HTML omitted -->Red Hat acquired it<!-- raw HTML omitted -->. I have been using it and find it useful for many projects but¬†not for others: what I love is the community oriented approach with a very responsive team and support for any kind of users (meaning from the 2 nodes web server to a RAID10 Infiniband cluster for high end storage).</p>
<p>My personal story with Gluster starts with a porting of a on-premise architecture in the cloud: moving¬†an existing application to the cloud, instead of redesigning it from scratch, involves a lot of engineering to adapt the current system settings to a scalable infrastructure. Gluster comes handy when talking about scaling: the latest milestone has a very simple and efficient way of reconfiguring the underlying hardware, adding and removing nodes in the storage pool is as simple as inputting a couple of commands from any of the peers in the cluster.</p>
<p>If you‚Äôre unfamiliar with Gluster concepts (storage pool, peers, etc‚Ä¶) I suggest you RTFM on <!-- raw HTML omitted -->Gluster‚Äôs website<!-- raw HTML omitted -->;¬†in this post I will detail a few points you won‚Äôt find on documentation and you should definetely know before starting to evaluate Gluster adoption.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>If you find Gluster is not suitable for your application, consider analizying¬† a different solution like <!-- raw HTML omitted -->DRBD<!-- raw HTML omitted -->: it may not be as cutting edge as Gluster or <!-- raw HTML omitted -->Ceph<!-- raw HTML omitted --> but may be the right solution for the job.</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2013-10-07-zabbix-a-powerful-yet-simple-monitoring-software/">Zabbix: a powerful yet simple monitoring software</a></h1>
  <p>It may come in mind to any IT system engineer to know what is the status of the network, server by server, instance by instance; it happened to me when I was given the responsibility to manage my company‚Äôs infrastructure and I was wondering which tool could have helped to do the job.</p>
<p>I chose Zabbix to monitor my infrastructure because:</p>
<ol>
<li>despite it‚Äôs a bit difficult to install (you need a PHP enabled web server, a database and a C compiler), you will benefit a very user-friendly web interface with lots of functionalities</li>
<li>native agents for major OS release are already complied: FreeBSD, Linux, Windows, etc‚Ä¶ Compiling to other OS just requires a ‚Äúconfigure &amp;&amp; make &amp;&amp; make install‚Äù</li>
<li>it offers many monitoring methods via a unique interface: you can group SNMP, JMX, HTTP monitoring in one shot</li>
<li>it has multi-step HTTP/HTTPS monitoring, simulating different browsers and clients</li>
<li>you can build nice infographics bundling all kind of monitored datas</li>
<li>you can manage users and roles to give access to the web interface at your company‚Äôs employees</li>
<li>you can build custom monitoring scripts to your needs</li>
</ol>
<p>Well let‚Äôs see some action now: I would like to post a short tutorial on how to build a custom script to monitor resources used by a Glassfish application server. You can use this methodology for other application servers or services.</p>
<p><strong>Requirements:</strong> you have installed Zabbix server, deployed an agent to a host, set up the necessary networking stuff</p>
<p>On the host to be monitored, you will have a directory where the agent configuration file is located (usually /usr/local/etc or C:\Zabbix)</p>
<p><strong>Step 1: enable custom parameters¬†<strong>parsing</strong></strong></p>
<p>Edit the file zabbix_agent.conf or zabbix_agentd.conf (depending if you‚Äôre usgin the daemon or not) and uncommment/add the following line:</p>
<p><em>Include=/usr/local/etc/zabbix_agentd.conf.d/ ¬†<em>or</em>¬†<em>Include=/usr/local/etc/zabbix_agent.conf.d/</em></em></p>
<p><strong>Step 2: write the script</strong></p>
<p>Create a file, name it as you please and insert the script you want to be executed by the agent: I needed a script that would inetract with Glassfish, so I used th following:</p>
<blockquote>
<p># Flexible parameter to grab global variables. On the frontend side, use keys like glassfish.status[server.jvm.heapsize-current].</p>
</blockquote>
<blockquote>
<p># Key syntax is glassfish.status[monitoring-key].</p>
</blockquote>
<blockquote>
<p>UserParameter=glassfish.status[*],/opt/glassfish/bin/asadmin get ‚Äìuser admin ‚Äìpasswordfile /opt/glassfish/bin/.pwd -m $1 | cut -d ‚Äú=‚Äù -f 2 | tr -d ‚Äò ‚Äò | bc</p>
</blockquote>
<p>The script syntax is always UsrParameter=name.of.script[*] followed by the code to be executed. This one uses the Glassfish utility ‚Äú<em>asadmin</em>‚Äù and a couple of shell commands to trim the string output and translate it into an integer value. You can see the arguments array can be retrieved using $ and index of argument. In this example you will call the script with one argument only (the monitoring data you want from Glassfish).</p>
<p><strong>Step 3: start harvesting datas!</strong></p>
<p>Once finished editing the script, go back to the Zabbix monitoring console and add an Item to the host you are monitoring. You will add the key as shown in the picture below:</p>
<p>¬†</p>
<p><a href="https://inge.4pr.es/blog/wp-content/uploads/2013/10/zabbix_custom_script1.png"><!-- raw HTML omitted --></a></p>
<p>¬†</p>
<p>¬†</p>
<p>Then go back to the dashboard and verify that the script just created is returning datas as expected. In the section <em>Monitoring-&gt;Latest Data</em> check if the item is giving the expected values. In this exemple I chose to monitor the current heap size used by the server. One cool thing is: once the script is done you can call it with all the parameters Glassfish has, and then combine datas in an infograph like the following:</p>
<p>¬†</p>
<p><a href="https://inge.4pr.es/blog/wp-content/uploads/2013/10/zabbix_graphs1.png"><!-- raw HTML omitted --></a></p>
<p>¬†</p>
<p>Here I put together two Glassfish parameters (JVM upper bound and current heap used) and a system parameter (free memory).</p>
<p>To get a list of all parameters you can monitor via Glassfish <em>asadmin</em> command see Glassfish documentation <!-- raw HTML omitted -->here<!-- raw HTML omitted -->.</p>
<p>Cheers,</p>
<p>inge4pres</p>
<p>¬†</p>

</article>
 
    </main><footer class="w-full text-center p-4 text-xs text-gray-400">
  <p>
    Built with
    <a
      href="https://gohugo.io"
      target="_blank"
      rel="noopener noreferrer"
      class="underline hover:text-blue-800 dark:hover:text-blue-300"
      >Hugo</a
    >
    and
    <a
      href="https://github.com/apvarun/showfolio-hugo-theme"
      target="_blank"
      rel="noopener noreferrer"
      class="underline hover:text-blue-800 dark:hover:text-blue-300"
      >Showfolio</a
    >
  </p>
</footer>

</body>
</html>
