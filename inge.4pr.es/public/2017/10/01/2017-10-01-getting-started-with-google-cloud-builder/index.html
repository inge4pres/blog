<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='GCB is a build tool to automate the creation of containerized applications'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Getting Started With Google Cloud Builder » INGE4PRES RATIONAL THOUGHTS'>
<meta property='og:description' content='GCB is a build tool to automate the creation of containerized applications'>
<meta property='og:url' content='http://inge.4pr.es/2017/10/01/2017-10-01-getting-started-with-google-cloud-builder/'>
<meta property='og:site_name' content='INGE4PRES RATIONAL THOUGHTS'>
<meta property='og:type' content='article'><meta property='article:publisher' content='358809487873346'><meta property='article:section' content='Post'><meta property='article:tag' content='gcp'><meta property='article:tag' content='cicd'><meta property='article:tag' content='development'><meta property='article:published_time' content='2017-10-01T21:31:52&#43;02:00'/><meta property='article:modified_time' content='2017-10-01T21:31:52&#43;02:00'/><meta property='fb:app_id' content='1845367892442473'><meta property='fb:admins' content='francesco.inge'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.45.1" />

  <title>Getting Started With Google Cloud Builder » INGE4PRES RATIONAL THOUGHTS</title>
  <link rel='canonical' href='http://inge.4pr.es/2017/10/01/2017-10-01-getting-started-with-google-cloud-builder/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.809149b6.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-55252403-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>


<body class='page type-post has-sidebar'>

  <div class='site'>

    <div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/avatar.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
     
    </h2>
    <div class='desc'>
    
    </div>
  </header>

</section>
</div>

  <div class='sidebar-overlay'></div>
</div>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    <a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button>
    <ul><li class='item'>
        <a href='/'>/</a>
      </li><li class='item'>
        <a href='/about'>/about</a>
      </li><li class='item'>
        <a href='/resume'>/resume</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>INGE4PRES RATIONAL THOUGHTS</p><p class='desc site-desc'>Growing knowledge one post at a time</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Getting Started With Google Cloud Builder</h1>
      
<p class='desc'>GCB is a build tool to automate the creation of containerized applications</p>


    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-10-01T21:31:52&#43;02:00'>1 Oct 2017</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
4 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p>One of the advantages of containerized applications is the standardization, some would say &ldquo;write it once, runs everywhere&rdquo; but that&rsquo;s another motto for another product. Anyway with a new packaging technology the same problems are faced: build reproducibility, or the necessity for people doing Ops to know they are going to deploy the same exact piece of code the Dev team used in their tests. So to address this issue the container image needs to be immutable: once it&rsquo;s built, it&rsquo;s not going to be changed, ever. And the same image will be used for testing, QA, beta, preview, presales-demo, whatever environment you need to deploy the app to.</p>

<h4 id="building-it">Building it</h4>

<p>Docker has been around for a few years now, it&rsquo;s mature and stable, but ask anyone using it if they&rsquo;d allow images built on development workstation to run in production: not gonna happen! The artifact that will serve production traffic will pass through the CI/CD pipelines and pushed to the registry, this is the way of shipping containers. &ldquo;That&rsquo;s easy&rdquo;, you&rsquo;ll say, &ldquo;I&rsquo;ll stick my Dockerfile in the repo and let the build system do the magic!&rdquo;, but that&rsquo;s not the whole picture: there are lower layers to pull, tests to be run and <em>only after they succeed</em> you can build the container. So who is going to maintain all of this configurations? Can we store them into the repo too? Yes! With GCB you can write a declarative multi-step workflow that will compile, test and package the code in a container; the container will get immediately pushed to the Google Container Registry too, so it&rsquo;s ready to be consumed (maybe Kubernetes on GKE?).</p>

<h4 id="a-simple-application">A simple application</h4>

<p>There is quite a good number of examples in the <a href="https://github.com/GoogleCloudPlatform/cloud-builders" title="GCB on Github" target="_blank">cloud builder repository</a> but I&rsquo;d like to create a fresh one with Golang: a random number generator. The app will serve a random integer via HTTP, and you can see the code is <a href="https://github.com/inge4pres/blog/blob/master/getting-started-with-google-cloud-builder/main.go" target="_blank">very straightforward</a>.
Now I want to build a container to run into GCP with confidence so that every time I make a build I will have a new container image tagged with the version and ready to roll it out.</p>

<h4 id="using-gcb">Using GCB</h4>

<p>All builds in GCB happen in a container, right now the only engine supported is Docker but more are going to be added. You can leverage Google pre-baked builders or use your own images as builders, in the example I am using Google&rsquo;s <code>golang-project</code> image to compile and <code>docker</code> to build the final docker image and push it to registry. Note how some environment variables are injected to the container, like <code>PROJECT_ID</code> is your GCP running project as configured via</p>

<pre><code>gcloud auth login
gcloud config set project your-gcp-project
</code></pre>

<h5 id="side-note-for-gophers"><em>Side note for gophers</em></h5>

<p>The <code>golang-project</code> image does some checks at setup to determine the workspace structure: there need to be a <code>./src</code> folder or <code>GOPATH</code> must be passed, or the simplest way is to <a href="https://github.com/inge4pres/blog/blob/master/getting-started-with-google-cloud-builder/main.go#L1" target="_blank">insert a comment next to <code>package main</code> in <code>main.go</code></a></p>

<h4 id="running-the-build">Running the build</h4>

<p>It&rsquo;s as easy as executing</p>

<pre><code>gcloud container builds submit --config cloudbuild.yaml .
</code></pre>

<p>in the root of your project.</p>

<p>See it in action!</p>

<script type="text/javascript" src="https://asciinema.org/a/vT8HIty3J6pJYKSEO5xxSBEBF.js" id="asciicast-vT8HIty3J6pJYKSEO5xxSBEBF" async></script>

<p>As you can see the current folder (<code>.</code> as last parameter) is compressed and shipped to a Cloud Storage random location, then GCB starts the steps listed in the configuration YAML file, running step by step the containers with their arguments.</p>

<h4 id="conclusion">Conclusion</h4>

<p>GCB is fast and very easy to use but for what I&rsquo;ve been able to test is bound to GCP right now, so if you are willing to deliver a service from Google Cloud and your application is containerized or <em>&ldquo;cloud native&rdquo;</em> you have a lightweight build system ready to go, but if you have a private registry or other integrations to do, GCB might still be a too small niche.</p>

<p>I&rsquo;ll make more tests and try to hack a bit GCB in the future so stay tuned!</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  <div class='categories'>
  <span class='taxonomy-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
</span>
  <span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/tech'>Tech</a></div>
<div class='tags'>
  <span class='taxonomy-icon'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
</span>
  <span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/gcp'>Gcp</a>, <a class='tag' href='/tags/cicd'>Cicd</a>, <a class='tag' href='/tags/development'>Development</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/2017/05/28/2017-05-28-devops-you-re-doing-it-wrong/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>DevOps: you&#39;re doing it wrong</a>
    </div><div class='next-entry sep-before'>
      <a href='/2017/10/28/2017-10-28-golang-concurrency-pattern/'>
        <span class='screen-reader-text'>Next post: </span>Golang Concurrency Patterns<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p>inge4pres &copy; 2012-2018 Francesco Gualazzi </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.68cb493a.js'></script>



</body>

</html>

