<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    software - inge4pres
  </title><meta name="generator" content="Hugo 0.98.0" /><link
    rel="stylesheet"
    href="https://inge.4pr.es/css/styles.css"
    integrity=""
  />
  
  <script>
    
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  </script>
  
</head>

  <body
    class="flex flex-col min-h-screen dark:bg-gray-900 dark:text-gray-100 transition-colors duration-500"
  ><header class="w-full px-4 pt-4 max-w-5xl mx-auto">
  <nav class="flex items-center justify-between flex-wrap">
    <div class="flex gap-2 items-center">
      
      <a href="mailto:fgualazzi@gmail.com" aria-label="EMail">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="4" />
          <path d="M16 12v1.5a2.5 2.5 0 0 0 5 0v-1.5a9 9 0 1 0 -5.5 8.28" />
        </svg>
      </a>
      
      <a href="https://inge.4pr.es/" class="flex items-center font-bold">
        inge4pres
      </a>
    </div>

    <ul id="nav-menu" class="flex w-auto mt-0 space-x-2">
      
      <li>
        <a href="https://inge.4pr.es/about/" class="hover:text-blue-800 dark:hover:text-blue-300">You are what you is (F. Zappa)</a>
      </li>
      
      
      <li>
        <a href="https://inge.4pr.es/categories/blog/" class="hover:text-blue-800 dark:hover:text-blue-300">blog</a>
      </li>
      
    </ul>
  </nav>
</header>
<main class="flex-1 mx-4 md:mx-12 lg:mx-24 mt-8 sm:mt-16"> 
<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/cloud-native-software-delivery/">Cloud-native applications: Operator-Framework</a></h1>
  <p><strong>Cloud-native</strong>: sounds attractive right? What does it even mean? <a href="https://en.wikipedia.org/wiki/Cloud-native">Wikipedia</a> has no page on it already so anyone can give its own definition&hellip; Here&rsquo;s mine:</p>
<p><em>A Cloud-native application has only concern on the functionalities that it has to deliver as it is completely decoupled from the infrastructure it runs on</em></p>
<p>So how can software delivery be cloud-native? Isn&rsquo;t software delivery supposed to &ldquo;install&rdquo; software onto some infrastructure? Well if your infrastructure provider <em>is</em> cloud-native, you can transitively deliver software on it in a cloud-native way (counts of cloud-native is over 9000, so stopping here)!</p>
<p>Recently RedHat acquired CoreOS, bold move if you ask me. CoreOS since the M&amp;A has been very quite until a week ago when the <a href="https://github.com/operator-framework">operator-framework</a> was announced through a <a href="https://coreos.com/blog/introducing-operator-framework">blog post</a>; this is a huge step forward for everyone as this new toolkit will empower the average developer with the ability to run operators on Kubernetes and package their applications as extensions to the Kubernetes API.</p>
<p>Never heard of <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/#customresourcedefinitions">Custom Resource Definitions</a>? You&rsquo;d better get on track as this will be driving the next-gen wave of applications that will run <em>as part</em> of the platform that delivers them, with the ability to automate their management and simplify dramatically their operations which will be tightly integrated with the cluster management itself.</p>
<p>And as usual I&rsquo;m eager to try out this new toy and see what can be done with it: I want to build a cloud-native software delivery application that will enable CI/CD jobs to be running inside the cluster and managed by the same API server! Using a CRD for the &ldquo;Pipeline&rdquo; kind I can control the build/test/release flow of my application and moreover monitor the whole thing with the same tools with which I will monitor my application.</p>
<h3 id="creating-cd">Creating CD¬≥</h3>
<p>I decided to start a new project called <a href="https://github.com/inge4pres/cdkube">CD¬≥ (cd kube)</a>: it will be a Continuous-* software that will run in Kubernetes and will be dedicated to deliver software <em>through</em> Kubernetes. I found Weaveworks did something similar with <a href="https://github.com/weaveworks/flux/">Flux</a> and since I don&rsquo;t want to reinvent the wheel I&rsquo;ll just try and replicate some functionality of running a continer in an operator.</p>
<p>First things first: I installed the <a href="https://github.com/operator-framework/operator-sdk">operator-sdk</a> and I have the binary in my <code>$GOPATH/bin</code>.
Running</p>
<pre tabindex="0"><code>$GOPATH/bin/operator-sdk new cdkube --api-version=delivery.inge.4pr.es/v1alpha1 --kind=Pipeline
</code></pre><p>I am resulting in an auto-generated project with some scaffold code, as in <a href="https://github.com/inge4pres/cdkube/commit/bd7a1cf8790cf02169057f759e40272993673181">this commit</a>.
Next I add some details which I think are at the core of a pipeline: the repository with code and configurations, the image to build the software and what version/name give to the resulting application artifact. When adding new items to the Spec and Status of CRD I will modify the <a href="https://github.com/inge4pres/cdkube/blob/master/pkg/apis/delivery/v1alpha1/types.go">pkg/apis/delivery/v1alpha1/types.go</a> file, then the guide suggests to run <code>operator-sdk generate k8s</code> to update the code, in fact the <code>zz_generated_deepcopy.go</code> is updated, but I don&rsquo;t see the <a href="https://github.com/inge4pres/cdkube/commit/5a17429d206475bcef85077d1f9aeb6fdda50357#diff-5cd8fbaa4e3fbb473c3e57c6fabca2f9">deploy/cr.yaml</a> changed as it should so probably there&rsquo;s a bug&hellip; Moving forward I have my operator logic to be defined now: I add some check whether the building pod is succeded and build the operator</p>
<pre tabindex="0"><code>operator-sdk build inge4pres/cdkube:v0.0.1
docker push inge4pres/cdkube:v0.0.1
</code></pre><p>My operator is built, pushed to dockerhub and ready to be kicked in a k8s cluster, so I fire up one in GKE</p>
<pre tabindex="0"><code>gcloud beta container --project &#34;inge4pres-gcp&#34; clusters create &#34;operator-framework-test&#34; --zone &#34;europe-west1-b&#34; --machine-type &#34;g1-small&#34; --image-type &#34;COS&#34; --disk-size &#34;25&#34;

gcloud container clusters get-credentials operator-framework-test --zone europe-west1-b --project inge4pres-gcp
</code></pre><p>and when it&rsquo;s ready I can deploy the auto-generated resources to the cluster.
An amazing result is that once the depoloyment is done I can create my CRD with the <code>kubectl</code> command and see my custom-type declared, running <code>kubectl create -f deploy/crd.yaml</code> I have a new object created in k8s</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú  ~ kubectl get pipeline
</span></span><span style="display:flex;"><span>NAME            AGE
</span></span><span style="display:flex;"><span>doing-nothing   16s
</span></span><span style="display:flex;"><span>‚ûú  ~ kubectl describe pipeline
</span></span><span style="display:flex;"><span>Name:         doing-nothing
</span></span><span style="display:flex;"><span>Namespace:    default
</span></span><span style="display:flex;"><span>Labels:       &lt;none&gt;
</span></span><span style="display:flex;"><span>Annotations:  &lt;none&gt;
</span></span><span style="display:flex;"><span>API Version:  delivery.inge.4pr.es/v1alpha1
</span></span><span style="display:flex;"><span>Kind:         Pipeline
</span></span><span style="display:flex;"><span>Metadata:
</span></span><span style="display:flex;"><span>  Cluster Name:
</span></span><span style="display:flex;"><span>  Creation Timestamp:             2018-05-05T18:08:31Z
</span></span><span style="display:flex;"><span>  Deletion Grace Period Seconds:  &lt;nil&gt;
</span></span><span style="display:flex;"><span>  Deletion Timestamp:             &lt;nil&gt;
</span></span><span style="display:flex;"><span>  Initializers:                   &lt;nil&gt;
</span></span><span style="display:flex;"><span>  Resource Version:               <span style="color:#bd93f9">1528</span>
</span></span><span style="display:flex;"><span>  Self Link:                      /apis/delivery.inge.4pr.es/v1alpha1/namespaces/default/pipelines/doing-nothing
</span></span><span style="display:flex;"><span>  UID:                            5160a990-508f-11e8-8f06-42010a8401f8
</span></span><span style="display:flex;"><span>Spec:
</span></span><span style="display:flex;"><span>Spec:
</span></span><span style="display:flex;"><span>  Build Arguments:
</span></span><span style="display:flex;"><span>    building something...
</span></span><span style="display:flex;"><span>    now I&#39;m <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span>  Build Commands:
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">echo</span>
</span></span><span style="display:flex;"><span>  Build Image:     busybox
</span></span><span style="display:flex;"><span>  Repo:            http://github.com/inge4pres/just-a-test
</span></span><span style="display:flex;"><span>  Target Name:     tesApp
</span></span><span style="display:flex;"><span>  Target Version:  0.1
</span></span><span style="display:flex;"><span>Events:            &lt;none&gt;
</span></span><span style="display:flex;"><span>‚ûú  ~</span></span></code></pre></div>
<p>When I deploy my operator and create the custom resource applying the manifest for a pipeline, the operator picks it up and starts a container with the name of the pipeline</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl apply -f deploy/cr.yaml
</span></span><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl get po
</span></span><span style="display:flex;"><span>NAME                      READY     STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>cdkube-57bcf65584-sbvd6   1/1       Running   <span style="color:#bd93f9">0</span>          12s
</span></span><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl apply -f deploy/cr.yaml
</span></span><span style="display:flex;"><span>pipeline <span style="color:#f1fa8c">&#34;doing-nothing&#34;</span> created
</span></span><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl get po
</span></span><span style="display:flex;"><span>NAME                      READY     STATUS              RESTARTS   AGE
</span></span><span style="display:flex;"><span>cdkube-57bcf65584-sbvd6   1/1       Running             <span style="color:#bd93f9">0</span>          29s
</span></span><span style="display:flex;"><span>testapp                   0/1       ContainerCreating   <span style="color:#bd93f9">0</span>          2s
</span></span><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl logs cdkube-57bcf65584-sbvd6
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2018-05-05T18:42:59Z&#34;</span> <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#8be9fd;font-style:italic">msg</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Go Version: go1.10.2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2018-05-05T18:42:59Z&#34;</span> <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#8be9fd;font-style:italic">msg</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Go OS/Arch: linux/amd64&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2018-05-05T18:42:59Z&#34;</span> <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#8be9fd;font-style:italic">msg</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;operator-sdk Version: 0.0.5+git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2018-05-05T18:42:59Z&#34;</span> <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#8be9fd;font-style:italic">msg</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;starting pipelines controller&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2018-05-05T18:43:21Z&#34;</span> <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#8be9fd;font-style:italic">msg</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;build still running, status of builder container: Pending&#34;</span>
</span></span><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl get po
</span></span><span style="display:flex;"><span>NAME                      READY     STATUS      RESTARTS   AGE
</span></span><span style="display:flex;"><span>cdkube-57bcf65584-sbvd6   1/1       Running     <span style="color:#bd93f9">0</span>          49s
</span></span><span style="display:flex;"><span>testapp                   0/1       Completed   <span style="color:#bd93f9">2</span>          22s</span></span></code></pre></div>
<p>and if I get the <code>testapp</code> logs I can see the pipeline execution</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú  cdkube git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ‚úó kubectl logs testapp
</span></span><span style="display:flex;"><span>building something... now I&#39;m <span style="color:#ff79c6">done</span></span></span></code></pre></div>
<p>Bonus: if the custom resource is deleted with <code>kubectl delete -f deploy/cr.yaml</code> the pod <code>testapp</code> gets terminated automatically! I don&rsquo;t know if this magic is done by Kubernetes or by the Operator Framework, but sure I love it as it will enable my resources to be managed with the k8s API just like any other.</p>
<p>I still need to tune the logic of handling the container as I didn&rsquo;t expect the restarts to happen, but hey this looks amazing! In a couple of hours I have an operator that can spawn containers when instructed to do so by custom manifests representing a pipeline!</p>
<p>Stay tuned üòé</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2016-01-24-implement-a-generic-data-list-structure/">Implement a generic data list structure</a></h1>
  <p>As a coding challenge I was asked to provide a generic list implementation using a language of my choice and using only primitive types, avoiding the use of high level built-ins. I chose <!-- raw HTML omitted -->Go<!-- raw HTML omitted --> because I want to learn it and I know it can be useful to create an abstract, generic implementation.</p>
<p>The challenge request to implement at least 4 methods on the generic type:</p>
<ul>
<li>Filter() ‚Äì ¬†returns a subset of the List satisfying an operation</li>
<li>Map() ‚Äì returns the List objects‚Äô map</li>
<li>Reverse() ‚Äì reverse the ordering of the List objects</li>
<li>FoldLeft() ‚Äì join the objects from left to right using a join character</li>
</ul>
<p>As a bonus question I was asked to code unit tests for the aforementioned methods and give an explanation on how the implementation guarantees concurrent access on resources.</p>
<p>So here is my implementation: the type List has only one attribute, an array of type <code>interface{}</code></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Every type will be convertible to the <code>interface{}</code> type, but as Golang has strong types the conversion is not implicit and must be declared.</p>
<p>Reverse() will create a new array of <code>interface{}</code> to hold the reversed list</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Map() returns the List elements‚Äô array, so it can be accessed as a whole</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>This two function types will help define a custom operation to be used in Filter() and FoldLeft(): <!-- raw HTML omitted -->functions are types<!-- raw HTML omitted --> in Go and this enable a great level of abstraction.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Filter() will use a filter function, without the need to define it (!), and return a portion of the List data array.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>FoldLeft() will use a fold function, again not yet defined, the return a single element made of the entire list.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>You can find all the code¬†<!-- raw HTML omitted -->here<!-- raw HTML omitted -->, any comment is welcome on how to improve the abstraction or efficiency of the implementation.</p>
<p>The opportunity to dig into the language ability to abstract is a very helpful way to better understand the language itself, so this coding challenge was a great opportunity to learn a little bit more Go!</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2015-08-02-golang-message-queue-a-simple-tcp-message-bus/">Golang Message Queue: a simple TCP message bus</a></h1>
  <p><strong>[TL;DR]</strong></p>
<p>I wrote a Pub/Sub message queue in <!-- raw HTML omitted -->Go<!-- raw HTML omitted -->, branch ‚Äúmaster‚Äù is stable but missing some interesting feature like distributed memory synchronization between nodes in a cluster and encryption. Code at</p>
<p><!-- raw HTML omitted --><a href="https://github.com/inge4pres/gmq">https://github.com/inge4pres/gmq</a><!-- raw HTML omitted --></p>
<p>Being a cloud system engineer, my work is to design and implement distributed systems: one of the key principles in designing such architectures is <em>decoupling</em>, which means ensuring the many parts composing the system are able to share informations and complete a sequence of operations without being tied together. You can read more about cloud architectures and decoupling here.</p>
<p>One of the most common scenario in a cloud application is a series of asynchronous operations executed by many nodes on different layers: for example a front end server tier receiving¬† files and a backend server tier doing analysis on them; a good practice is to have a message queue between the two serving as an orchestration component. Each web server node will post a message in the queue for every files received, each backend node will consume a message from the queue to complete his operations on the files. In this way the two tiers are independent one from each other: in case of backend failure or over-capacity, the web servers will keep receiving files and storing message in the queue. If the two operations where done synchronously, the backend failure would stop the whole system to work.</p>
<p>A lot of <em>off-the-shelf</em> message queue software is already available, but I felt like writing my own would give me a good point of view on system programming with Go, so I wrote it, and the result is pretty awesome too. In a few days I was able to have a configurable message queue storing messages in memory, on filesystem or database (MySQL); communication is based on JSON via TCP, and the server can be configured to support a maximum number of queues, a maximum message length and queue capacity: combination of the configured parameters will have performance effects on the single node.</p>
<p>The roadmap of ‚Äúdeveloment‚Äù branch is:</p>
<ul>
<li>adding cluster mode</li>
<li>adding memory synchronization in cluster mode</li>
<li>adding encryption: TLS over TCP</li>
<li>adding client authentication</li>
</ul>
<p>As you may have guessed from the above list, security of GMQ is not implemented at the moment, be careful!</p>
<p>Feel free to try it out and give suggestions!</p>
<p>Cheers üòÄ</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2015-06-11-my-first-golang-web-project/">My first Golang web project is online</a></h1>
  <p>It is true: I fell in love with <!-- raw HTML omitted -->Go<!-- raw HTML omitted -->, not because I love Google and his products, but because it really fits my ideology of simplicity and power in a programming language. I started experimenting with the language and thank to his web-oriented approach I quickly came up with one of the simplest single task web application I could write: a URL shortener.</p>
<p>What is a URL shortener? It‚Äôs a service that will give you a short link for a long URL.</p>
<p>Why should I use it? A short URL is easier to remember and to copy and paste, it lets you write more on social media where characters are limited (Twitter).</p>
<p>Why writing one when there are plenty of them already? Other shortener have an expiration date on short links, <!-- raw HTML omitted -->4pr.es<!-- raw HTML omitted --> doesn‚Äôt!</p>
<p>Take a look at the <!-- raw HTML omitted -->code<!-- raw HTML omitted --> and you‚Äôll see it is very simple: it takes a URL as text input filed of a form</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>generates a random string of 6 charachters, checking that the string is not in the database</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>and keep the URL ‚Äì string association in the database for further redirection; once the random short URL is visited the client gets redirected to the origianl long URL!</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>So please try it and if you have any suggestion to increase performance or security please let me know!</p>
<p>Cheers</p>
<p>¬†</p>
<p>¬†</p>

</article>

<article class="sm:mx-12 mb-16 prose lg:prose-lg">
  <h1><a href="https://inge.4pr.es/post/2013-10-07-zabbix-a-powerful-yet-simple-monitoring-software/">Zabbix: a powerful yet simple monitoring software</a></h1>
  <p>It may come in mind to any IT system engineer to know what is the status of the network, server by server, instance by instance; it happened to me when I was given the responsibility to manage my company‚Äôs infrastructure and I was wondering which tool could have helped to do the job.</p>
<p>I chose Zabbix to monitor my infrastructure because:</p>
<ol>
<li>despite it‚Äôs a bit difficult to install (you need a PHP enabled web server, a database and a C compiler), you will benefit a very user-friendly web interface with lots of functionalities</li>
<li>native agents for major OS release are already complied: FreeBSD, Linux, Windows, etc‚Ä¶ Compiling to other OS just requires a ‚Äúconfigure &amp;&amp; make &amp;&amp; make install‚Äù</li>
<li>it offers many monitoring methods via a unique interface: you can group SNMP, JMX, HTTP monitoring in one shot</li>
<li>it has multi-step HTTP/HTTPS monitoring, simulating different browsers and clients</li>
<li>you can build nice infographics bundling all kind of monitored datas</li>
<li>you can manage users and roles to give access to the web interface at your company‚Äôs employees</li>
<li>you can build custom monitoring scripts to your needs</li>
</ol>
<p>Well let‚Äôs see some action now: I would like to post a short tutorial on how to build a custom script to monitor resources used by a Glassfish application server. You can use this methodology for other application servers or services.</p>
<p><strong>Requirements:</strong> you have installed Zabbix server, deployed an agent to a host, set up the necessary networking stuff</p>
<p>On the host to be monitored, you will have a directory where the agent configuration file is located (usually /usr/local/etc or C:\Zabbix)</p>
<p><strong>Step 1: enable custom parameters¬†<strong>parsing</strong></strong></p>
<p>Edit the file zabbix_agent.conf or zabbix_agentd.conf (depending if you‚Äôre usgin the daemon or not) and uncommment/add the following line:</p>
<p><em>Include=/usr/local/etc/zabbix_agentd.conf.d/ ¬†<em>or</em>¬†<em>Include=/usr/local/etc/zabbix_agent.conf.d/</em></em></p>
<p><strong>Step 2: write the script</strong></p>
<p>Create a file, name it as you please and insert the script you want to be executed by the agent: I needed a script that would inetract with Glassfish, so I used th following:</p>
<blockquote>
<p># Flexible parameter to grab global variables. On the frontend side, use keys like glassfish.status[server.jvm.heapsize-current].</p>
</blockquote>
<blockquote>
<p># Key syntax is glassfish.status[monitoring-key].</p>
</blockquote>
<blockquote>
<p>UserParameter=glassfish.status[*],/opt/glassfish/bin/asadmin get ‚Äìuser admin ‚Äìpasswordfile /opt/glassfish/bin/.pwd -m $1 | cut -d ‚Äú=‚Äù -f 2 | tr -d ‚Äò ‚Äò | bc</p>
</blockquote>
<p>The script syntax is always UsrParameter=name.of.script[*] followed by the code to be executed. This one uses the Glassfish utility ‚Äú<em>asadmin</em>‚Äù and a couple of shell commands to trim the string output and translate it into an integer value. You can see the arguments array can be retrieved using $ and index of argument. In this example you will call the script with one argument only (the monitoring data you want from Glassfish).</p>
<p><strong>Step 3: start harvesting datas!</strong></p>
<p>Once finished editing the script, go back to the Zabbix monitoring console and add an Item to the host you are monitoring. You will add the key as shown in the picture below:</p>
<p>¬†</p>
<p><a href="https://inge.4pr.es/blog/wp-content/uploads/2013/10/zabbix_custom_script1.png"><!-- raw HTML omitted --></a></p>
<p>¬†</p>
<p>¬†</p>
<p>Then go back to the dashboard and verify that the script just created is returning datas as expected. In the section <em>Monitoring-&gt;Latest Data</em> check if the item is giving the expected values. In this exemple I chose to monitor the current heap size used by the server. One cool thing is: once the script is done you can call it with all the parameters Glassfish has, and then combine datas in an infograph like the following:</p>
<p>¬†</p>
<p><a href="https://inge.4pr.es/blog/wp-content/uploads/2013/10/zabbix_graphs1.png"><!-- raw HTML omitted --></a></p>
<p>¬†</p>
<p>Here I put together two Glassfish parameters (JVM upper bound and current heap used) and a system parameter (free memory).</p>
<p>To get a list of all parameters you can monitor via Glassfish <em>asadmin</em> command see Glassfish documentation <!-- raw HTML omitted -->here<!-- raw HTML omitted -->.</p>
<p>Cheers,</p>
<p>inge4pres</p>
<p>¬†</p>

</article>
 
    </main><footer class="w-full text-center p-4 text-xs text-gray-400">
  <p>
    Built with
    <a
      href="https://gohugo.io"
      target="_blank"
      rel="noopener noreferrer"
      class="underline hover:text-blue-800 dark:hover:text-blue-300"
      >Hugo</a
    >
    and
    <a
      href="https://github.com/apvarun/showfolio-hugo-theme"
      target="_blank"
      rel="noopener noreferrer"
      class="underline hover:text-blue-800 dark:hover:text-blue-300"
      >Showfolio</a
    >
  </p>
</footer>

</body>
</html>
